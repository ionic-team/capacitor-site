{"title":"Capacitor iOS Plugin Guide","description":"Capacitor iOS Plugin Guide","url":"/docs/plugins/ios","contributors":["mlynch","jcesarmobile"],"lastUpdated":"2020-05-31T23:03:42Z","headings":[{"id":"capacitor-ios-plugin-guide","level":1,"text":"Capacitor iOS Plugin Guide"},{"id":"getting-started","level":2,"text":"Getting Started"},{"id":"building-your-plugin-in-swift","level":2,"text":"Building your Plugin in Swift"},{"id":"simple-example","level":3,"text":"Simple Example"},{"id":"accessing-called-data","level":3,"text":"Accessing Called Data"},{"id":"returning-data-back","level":3,"text":"Returning Data Back"},{"id":"presenting-native-screens","level":3,"text":"Presenting Native Screens"},{"id":"events","level":3,"text":"Events"},{"id":"app-events","level":4,"text":"App Events"},{"id":"plugin-events","level":4,"text":"Plugin Events"},{"id":"override-navigation","level":3,"text":"Override navigation"},{"id":"export-to-capacitor","level":3,"text":"Export to Capacitor"}],"srcPath":"./docs-md/plugins/ios.md","content":"\n<h1 id=\"capacitor-ios-plugin-guide\">\n  \n  Capacitor iOS Plugin Guide\n  \n</h1>\n<p class=\"intro\">Building Capacitor plugins for iOS involves writing Swift (or Objective-C) to interface with Apple's iOS SDKs.</p>\n\n<p class=\"intro\">Capacitor embraces standard iOS development tools for building iOS plugins. We believe that using Swift (or, Objective-C) directly will make it easier to use existing solutions on Stack Overflow, share work with existing native developers, and use platform features as soon as they are made available.</p>\n\n\n<h2 id=\"getting-started\">\n  <a class=\"heading-link\" href=\"#getting-started\"><ion-icon name=\"link\"></ion-icon>\n  Getting Started\n  </a>\n</h2>\n<p>To get started, first generate a plugin as shown in the <a href=\"/docs/plugins/#getting-started\">Getting Started</a> section of the Plugin guide.</p>\n<p>Next, open <code>your-plugin/ios/Plugin.xcworkspace</code> in Xcode.</p>\n\n<h2 id=\"building-your-plugin-in-swift\">\n  <a class=\"heading-link\" href=\"#building-your-plugin-in-swift\"><ion-icon name=\"link\"></ion-icon>\n  Building your Plugin in Swift\n  </a>\n</h2>\n<p>A Capacitor plugin for iOS is a simple Swift class that extends <code>CAPPlugin</code> and\nhas some exported methods that will be callable from JavaScript.</p>\n<p>Once your plugin is generated, you can start editing it by opening <code>Plugin.swift</code>.</p>\n\n<h3 id=\"simple-example\">\n  <a class=\"heading-link\" href=\"#simple-example\"><ion-icon name=\"link\"></ion-icon>\n  Simple Example\n  </a>\n</h3>\n<p> In the generated example, there is a simple echo plugin with an <code>echo</code> function that simply returns a value that it was given.</p>\n<p> This example demonstrates a few core components of Capacitor plugins: receiving data from a Plugin Call, and returning\n data back to the caller:</p>\n<p><code>Plugin.swift</code></p>\n\n  <highlight-code-line >\n    <pre class=\"language-swift\"><code><span class=\"token keyword\">import</span> <span class=\"token builtin\">Capacitor</span>\n\n@<span class=\"token function\">objc</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">MyPlugin</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyPlugin</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">CAPPlugin</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token atrule\">@objc</span> <span class=\"token keyword\">func</span> <span class=\"token function\">echo</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> call<span class=\"token punctuation\">:</span> <span class=\"token builtin\">CAPPluginCall</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> call<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"value\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span><span class=\"token operator\">?</span> <span class=\"token string\">\"\"</span>\n    call<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"value\"</span><span class=\"token punctuation\">:</span> value\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n  </highlight-code-line>\n  \n<h3 id=\"accessing-called-data\">\n  <a class=\"heading-link\" href=\"#accessing-called-data\"><ion-icon name=\"link\"></ion-icon>\n  Accessing Called Data\n  </a>\n</h3>\n<p>Each plugin method receives an instance of <code>CAPPluginCall</code> containing all the information of the plugin method invocation from the client.</p>\n<p>A client can send any data that can be JSON serialized, such as numbers, text, booleans, objects, and arrays. This data\nis accessible on the <code>options</code> field of the call instance, or by using convenience methods such as <code>getString</code> or <code>getObject</code>.</p>\n<p>For example, here is how you&#39;d get data passed to your method:</p>\n\n  <highlight-code-line >\n    <pre class=\"language-swift\"><code><span class=\"token atrule\">@objc</span> <span class=\"token keyword\">func</span> <span class=\"token function\">storeContact</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> call<span class=\"token punctuation\">:</span> <span class=\"token builtin\">CAPPluginCall</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> name <span class=\"token operator\">=</span> call<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yourName\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span><span class=\"token operator\">?</span> <span class=\"token string\">\"default name\"</span>\n  <span class=\"token keyword\">let</span> address <span class=\"token operator\">=</span> call<span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"address\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">let</span> isAwesome <span class=\"token operator\">=</span> call<span class=\"token punctuation\">.</span><span class=\"token function\">getBool</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"isAwesome\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span><span class=\"token operator\">?</span> <span class=\"token boolean\">false</span>\n\n  <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> id <span class=\"token operator\">=</span> call<span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">[</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token builtin\">String</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    call<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Must provide an id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// ...</span>\n\n  call<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n  </highlight-code-line>\n  <p>Notice the various ways data can be accessed on the <code>CAPPluginCall</code> instance, including how to require\noptions using <code>guard</code>.</p>\n\n<h3 id=\"returning-data-back\">\n  <a class=\"heading-link\" href=\"#returning-data-back\"><ion-icon name=\"link\"></ion-icon>\n  Returning Data Back\n  </a>\n</h3>\n<p>A plugin call can succeed or fail. For calls using promises (most common), succeeding corresponds to calling <code>resolve</code> on the Promise, and failure calling <code>reject</code>. For those using callbacks, a succeeding will call the success callback or the error callback if failing.</p>\n<p>The <code>resolve</code> method of <code>CAPPluginCall</code> takes a dictionary and supports JSON-serializable data types. Here&#39;s an example of returning data back to the client:</p>\n\n  <highlight-code-line >\n    <pre class=\"language-swift\"><code>call<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"added\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"info\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">:</span> id\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre>\n  </highlight-code-line>\n  <p>To fail, or reject a call, call <code>call.reject</code>, passing an error string and (optionally) an <code>Error</code> instance and extra data back:</p>\n\n  <highlight-code-line >\n    <pre class=\"language-swift\"><code>call<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">.</span>localizedDescription<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"item1\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre>\n  </highlight-code-line>\n  \n<h3 id=\"presenting-native-screens\">\n  <a class=\"heading-link\" href=\"#presenting-native-screens\"><ion-icon name=\"link\"></ion-icon>\n  Presenting Native Screens\n  </a>\n</h3>\n<p>To present a Native Screen over the Capacitor screen we need to acces the Capacitor&#39;s View Controller.\nTo access the Capacitor&#39;s View Controller, we have to use the <code>CAPBridge</code> object available on <code>CAPPlugin</code> class.</p>\n<p>We can use the <code>UIViewController</code> to present Native View Controllers over it like this:</p>\n\n  <highlight-code-line >\n    <pre class=\"language-swift\"><code><span class=\"token builtin\">DispatchQueue</span><span class=\"token punctuation\">.</span>main<span class=\"token punctuation\">.</span>async <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>bridge<span class=\"token punctuation\">.</span>viewController<span class=\"token punctuation\">.</span><span class=\"token function\">present</span><span class=\"token punctuation\">(</span>ourCustomViewController<span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n  </highlight-code-line>\n  <p>Using <code>DispatchQueue.main.async</code> makes your view render from the main thread instead of a background thread. Removing this can cause unexpected results.</p>\n<p>On iPad devices you can also present <code>UIPopovers</code>, to do so, we provide a helper function to show it centered.</p>\n\n  <highlight-code-line >\n    <pre class=\"language-swift\"><code><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">setCenteredPopover</span><span class=\"token punctuation\">(</span>ourCustomViewController<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>bridge<span class=\"token punctuation\">.</span>viewController<span class=\"token punctuation\">.</span><span class=\"token function\">present</span><span class=\"token punctuation\">(</span>ourCustomViewController<span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span></code></pre>\n  </highlight-code-line>\n  \n<h3 id=\"events\">\n  <a class=\"heading-link\" href=\"#events\"><ion-icon name=\"link\"></ion-icon>\n  Events\n  </a>\n</h3>\n<p>Capacitor Plugins can emit App events and Plugin events</p>\n\n<h4 id=\"app-events\">\n  <a class=\"heading-link\" href=\"#app-events\"><ion-icon name=\"link\"></ion-icon>\n  App Events\n  </a>\n</h4>\n<p>App Events are regular javascript events, like <code>window</code> or <code>document</code> events.</p>\n<p>Capacitor provides all this functions to fire events:</p>\n\n  <highlight-code-line >\n    <pre class=\"language-swift\"><code>\n<span class=\"token comment\">//If you want to provide the target</span>\n<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>bridge<span class=\"token punctuation\">.</span><span class=\"token function\">triggerJSEvent</span><span class=\"token punctuation\">(</span>eventName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"myCustomEvent\"</span><span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">:</span> <span class=\"token string\">\"window\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>bridge<span class=\"token punctuation\">.</span><span class=\"token function\">triggerJSEvent</span><span class=\"token punctuation\">(</span>eventName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"myCustomEvent\"</span><span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">:</span> <span class=\"token string\">\"document\"</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">:</span> <span class=\"token string\">\"my custom data\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Window Events</span>\n<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>bridge<span class=\"token punctuation\">.</span><span class=\"token function\">triggerWindowJSEvent</span><span class=\"token punctuation\">(</span>eventName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"myCustomEvent\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>bridge<span class=\"token punctuation\">.</span><span class=\"token function\">triggerWindowJSEvent</span><span class=\"token punctuation\">(</span>eventName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"myCustomEvent\"</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">:</span> <span class=\"token string\">\"my custom data\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Document events</span>\n<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>bridge<span class=\"token punctuation\">.</span><span class=\"token function\">triggerDocumentJSEvent</span><span class=\"token punctuation\">(</span>eventName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"myCustomEvent\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>bridge<span class=\"token punctuation\">.</span><span class=\"token function\">triggerDocumentJSEvent</span><span class=\"token punctuation\">(</span>eventName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"myCustomEvent\"</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">:</span> <span class=\"token string\">\"my custom data\"</span><span class=\"token punctuation\">)</span></code></pre>\n  </highlight-code-line>\n  <p>And to listen for it, just use regular javascript:</p>\n\n  <highlight-code-line >\n    <pre class=\"language-typescript\"><code>window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myCustomEvent\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myCustomEvent was fired\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n  </highlight-code-line>\n  \n<h4 id=\"plugin-events\">\n  <a class=\"heading-link\" href=\"#plugin-events\"><ion-icon name=\"link\"></ion-icon>\n  Plugin Events\n  </a>\n</h4>\n<p>Plugins can emit their own events that you can listen by attaching a listener to the plugin Object like this:</p>\n\n  <highlight-code-line >\n    <pre class=\"language-typescript\"><code>Plugins<span class=\"token punctuation\">.</span>MyPlugin<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myPluginEvent'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">info<span class=\"token punctuation\">:</span> <span class=\"token builtin\">any</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myPluginEvent was fired'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n  </highlight-code-line>\n  <p>To emit the event from the Swift plugin class you can do it like this:</p>\n<p><code>self.notifyListeners(&quot;myPluginEvent&quot;, data: [:])</code></p>\n<p>To remove a listener from the plugin object:</p>\n\n  <highlight-code-line >\n    <pre class=\"language-typescript\"><code><span class=\"token keyword\">const</span> myPluginEventListener <span class=\"token operator\">=</span> Plugins<span class=\"token punctuation\">.</span>MyPlugin<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myPluginEvent\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">info<span class=\"token punctuation\">:</span> <span class=\"token builtin\">any</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myPluginEvent was fired\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmyPluginEventListener<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n  </highlight-code-line>\n  \n<h3 id=\"override-navigation\">\n  <a class=\"heading-link\" href=\"#override-navigation\"><ion-icon name=\"link\"></ion-icon>\n  Override navigation\n  </a>\n</h3>\n<p>Capacitor plugins can override the webview navigation. For that the plugin can override <code>- (NSNumber *)shouldOverrideLoad:(WKNavigationAction *)navigationAction</code> method.\nReturning <code>true</code> causes the WebView to abort loading the URL.\nReturning <code>false</code> causes the WebView to continue loading the URL.\nReturning <code>nil</code> will defer to the default Capacitor policy.</p>\n\n<h3 id=\"export-to-capacitor\">\n  <a class=\"heading-link\" href=\"#export-to-capacitor\"><ion-icon name=\"link\"></ion-icon>\n  Export to Capacitor\n  </a>\n</h3>\n<p>To make sure Capacitor can see your plugin, you must do two things: export your Swift class to Objective-C, and register it\nusing the provided Capacitor Objective-C Macros.</p>\n<p>To export your Swift class to Objective-C, make sure to add <code>@objc(YourPluginClass)</code> above your Swift class, and add <code>@objc</code> before any plugin method, as shown above.</p>\n<p>To register your plugin with Capacitor, you&#39;ll need to create a new Objective-C file (with a <code>.m</code> extension, <em>not</em> <code>.h</code>!) corresponding to your plugin (such as <code>MyPlugin.m</code>) and use the Capacitor macros to register the plugin, and each method that you will use. Important: you <em>must</em> use the New File dialog in Xcode to do this. You&#39;ll then be prompted by Xcode to create a Bridging Header, which you <em>must</em> do.</p>\n<p>Finally, register the plugin by adding the required Capacitor plugin macros into your new <code>.m</code> file:</p>\n\n  <highlight-code-line >\n    <pre class=\"language-objectivec\"><code><span class=\"token macro property\">#<span class=\"token directive keyword\">import</span> &lt;Capacitor/Capacitor.h></span>\n\n<span class=\"token function\">CAP_PLUGIN</span><span class=\"token punctuation\">(</span>MyPlugin<span class=\"token punctuation\">,</span> <span class=\"token string\">\"MyPlugin\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">CAP_PLUGIN_METHOD</span><span class=\"token punctuation\">(</span>echo<span class=\"token punctuation\">,</span> CAPPluginReturnPromise<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">)</span></code></pre>\n  </highlight-code-line>\n  <p>This makes <code>MyPlugin</code>, and the <code>echo</code> method available to the Capacitor web runtime, indicating to Capacitor that the echo method will return a Promise.</p>\n"}